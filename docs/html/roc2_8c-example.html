<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Strateole 2 Project: roc2.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Strateole 2 Project"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Strateole 2 Project
   </div>
   <div id="projectbrief">HaaseResearchGroup@UCSD</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,true,'search.php','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('roc2_8c-example.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">roc2.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> *      @file roc2.c</span></div><div class="line"><span class="comment"> *      @brief ROC2 Initial Data Collection Program</span></div><div class="line"><span class="comment"> *      </span></div><div class="line"><span class="comment"> *      This program is the first version of data collection software for the ROC2 Radio</span></div><div class="line"><span class="comment"> *      Occultation Instrument. It lacks the full feature set of the final instrument but</span></div><div class="line"><span class="comment"> *      performs the following:</span></div><div class="line"><span class="comment"> *      </span></div><div class="line"><span class="comment"> *      - Reads configuration file to determine commands for setting up GPS receiver</span></div><div class="line"><span class="comment"> *      - Configures GPS receiver</span></div><div class="line"><span class="comment"> *      - Launch data offload program</span></div><div class="line"><span class="comment"> *      - Logs data received from GPS receiver to files</span></div><div class="line"><span class="comment"> *      - When data file is closed, calls data processing script and open new file</span></div><div class="line"><span class="comment"> *      </span></div><div class="line"><span class="comment"> *      @author David Jabson, Brainstorm Engineering 2018 </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *      @addtogroup roc2_code</span></div><div class="line"><span class="comment"> *      @{</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;libconfig.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;termios.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;poll.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;dirent.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/types.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="roc2_8h.html">roc2.h</a>&quot;</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/// \brief Main function.</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="comment">/// Calls RocInit() to perform initialization then enters the main while loop where it</span></div><div class="line"><span class="comment">/// .... </span></div><div class="line"><span class="comment">/// the main loop stops, then RocCleanup() is called before exiting.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="keywordtype">int</span> <a name="a0"></a><a class="code" href="group__roc2__code.html#ga0ddf1224851353fc92bfbff6f499fa97">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> err, acked, i, numread, j;</div><div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *cmd_endptr, *cmd_readptr, *data_endptr, *data_readptr;</div><div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> term, cmd_readbuf[<a name="a1"></a><a class="code" href="group__roc2__header.html#gaa0534241791f23ec8098503582406166">READBUFSIZE</a>*2], cmd_linebuf[<a class="code" href="group__roc2__header.html#gaa0534241791f23ec8098503582406166">READBUFSIZE</a>/2], data_readbuf[<a class="code" href="group__roc2__header.html#gaa0534241791f23ec8098503582406166">READBUFSIZE</a>*2];</div><div class="line">        <span class="keyword">struct </span>termios options;</div><div class="line">        <span class="keyword">struct </span>timespec curtime;</div><div class="line">        FILE *wkfp;</div><div class="line"></div><div class="line">        <span class="keyword">struct </span>pollfd fds[2];</div><div class="line"></div><div class="line">        err = <a name="a2"></a><a class="code" href="group__roc2__code.html#gadaf639dd3b74bbc423f3e475d724f5bd">RocInit</a>(argc, argv);</div><div class="line">        <span class="keywordflow">if</span>(err&lt;0)</div><div class="line">        {</div><div class="line">                fprintf(stderr, <span class="stringliteral">&quot;%s: Initialization error %d. Exiting\r\n&quot;</span>,<a name="a3"></a><a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,err);</div><div class="line"><span class="comment">//              led(RED);</span></div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                printf(<span class="stringliteral">&quot;SWVersion = %s\r\nSWDate = %s\r\n&quot;</span>,<a name="a4"></a><a class="code" href="group__roc2__header.html#gad6f212287232c8a7d12dbc0e5901635d">SWVersion</a>,<a name="a5"></a><a class="code" href="group__roc2__header.html#ga8e5d9993745ca60b1777be3b1fa57a53">SWDate</a>);</div><div class="line">                printf(<span class="stringliteral">&quot;%s: Module started.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><span class="comment">//              led(GREEN);</span></div><div class="line">        }</div><div class="line"></div><div class="line">        err = <a name="a6"></a><a class="code" href="group__roc2__code.html#gae79420e415eafcf286a5f045194271d1">GPSStartupCmds</a>();</div><div class="line">        <span class="keywordflow">if</span>(err&lt;0)</div><div class="line">        {</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                <span class="keywordflow">if</span>(<a name="a7"></a><a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Processed %d startup commands.\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, err);</div><div class="line">        }</div><div class="line"></div><div class="line">        term=<a name="a8"></a><a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a name="a9"></a><a class="code" href="group__roc2__header.html#ga29c6cbcf2159ec289aa7742b1e99b316">term</a>[strlen(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga29c6cbcf2159ec289aa7742b1e99b316">term</a>)-1];</div><div class="line">        cmd_readptr=cmd_readbuf;</div><div class="line">        memset(cmd_readbuf, 0, <span class="keyword">sizeof</span>(cmd_readbuf));</div><div class="line">        data_readptr=data_readbuf;</div><div class="line">        memset(data_readbuf, 0, <span class="keyword">sizeof</span>(data_readbuf));</div><div class="line"></div><div class="line">        fds[0].fd = <a name="a10"></a><a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a name="a11"></a><a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>;</div><div class="line">        fds[0].events = POLLIN;</div><div class="line">        fds[1].fd = <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>;</div><div class="line">        fds[1].events = POLLIN;</div><div class="line"></div><div class="line"><span class="comment">//      tcgetattr(serial.fp, &amp;options);                                         // Get current port options</span></div><div class="line"><span class="comment">//      options.c_cflag |= CREAD;                                                       // Enable the serial receiver</span></div><div class="line"><span class="comment">//      tcflush(serial.fp,TCIOFLUSH);                                           // Flush serial buffers</span></div><div class="line"><span class="comment">//      if(tcsetattr(serial.fp, TCSANOW, &amp;options) == 0)        // Make the new settings active</span></div><div class="line"></div><div class="line">    <a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = 1;</div><div class="line">        numread = 0;</div><div class="line"><span class="comment">//      fp = 0;</span></div><div class="line"></div><div class="line">        <span class="keywordflow">while</span>(!<a name="a12"></a><a class="code" href="group__roc2__header.html#ga2896431d6a80cd39b3d24b40237612ee">quit</a>)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">if</span>(time(NULL) &gt;= <a name="a13"></a><a class="code" href="group__roc2__header.html#ga7efc4b1ce527042655fec03571c9042f">nextfile</a>.tv_sec)</div><div class="line">                {</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga7efc4b1ce527042655fec03571c9042f">nextfile</a>.tv_sec+=<a name="a14"></a><a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a>;</div><div class="line">                        <span class="keywordflow">if</span> (numread &amp;&amp; <a name="a15"></a><a class="code" href="group__roc2__header.html#gaa065f30aa9f5f9a42132c82c787ee70b">fp</a>) {</div><div class="line">                                err = <a name="a16"></a><a class="code" href="group__roc2__code.html#gaf31e21e2ff935496c7ce8dc5e52b65c3">LogData</a>(<a class="code" href="group__roc2__header.html#gaa065f30aa9f5f9a42132c82c787ee70b">fp</a>, data_readbuf, numread);</div><div class="line">                                <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Logged %d bytes, err=%d : 1\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, numread, err);</div><div class="line">                                numread = 0;</div><div class="line">                        }</div><div class="line">                        <a name="a17"></a><a class="code" href="group__roc2__code.html#ga5366f78d45883b7ad5934d6910efa6c5">NewFile</a>();</div><div class="line">                }</div><div class="line"></div><div class="line"><span class="preprocessor">#if 0</span></div><div class="line">                <span class="keywordflow">if</span> ((wkfp = fopen(<span class="stringliteral">&quot;/data/roc/FLAGWAKEUP&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>)) &gt; 0) {</div><div class="line">                        <span class="keywordtype">char</span> buf[50];</div><div class="line">                        <span class="keywordtype">int</span> saveSpeed;</div><div class="line"></div><div class="line">                        printf(<span class="stringliteral">&quot;roc: Wakeup GPS\n&quot;</span>);</div><div class="line">                        close(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>);</div><div class="line">                        saveSpeed = <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a name="a18"></a><a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a>;</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a> = 4800;</div><div class="line">                        err = <a name="a19"></a><a class="code" href="group__roc2__code.html#gaa1c32480aaf288a615cc7330e9cb6072">SerialPortInit</a>(&amp;<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>);</div><div class="line">                        <span class="keywordflow">if</span>(err != <a name="a20"></a><a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>) </div><div class="line">                                printf(<span class="stringliteral">&quot;roc: Baud rate change to 4800 unsuccessful&quot;</span>);</div><div class="line">                        </div><div class="line">                        <span class="keywordflow">for</span> (i=0;i&lt;50;i++) buf[i] = 0;</div><div class="line">                        fclose(wkfp);</div><div class="line">                        write(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, buf, 1);</div><div class="line">                        usleep(100000);</div><div class="line">                        write(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, buf, 1);</div><div class="line">                        usleep(100000);</div><div class="line">                        write(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, buf, 1);</div><div class="line">                        usleep(100000);</div><div class="line">                        write(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, buf, 1);</div><div class="line">                        usleep(100000);</div><div class="line">                        write(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, buf, 1);</div><div class="line">                        usleep(100000);</div><div class="line">                        write(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, buf, 1);</div><div class="line">                        usleep(500000);</div><div class="line">                        close(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>);</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a> = saveSpeed;</div><div class="line">                        err = <a class="code" href="group__roc2__code.html#gaa1c32480aaf288a615cc7330e9cb6072">SerialPortInit</a>(&amp;<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>);</div><div class="line">                        <span class="keywordflow">if</span>(err != <a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>) </div><div class="line">                                printf(<span class="stringliteral">&quot;roc: Baud rate change to %d unsuccessful&quot;</span>, saveSpeed);</div><div class="line">                        usleep(200000);</div><div class="line"></div><div class="line">                        system(<span class="stringliteral">&quot;rm /data/roc/FLAGWAKEUP&quot;</span>);</div><div class="line">                }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">                <span class="keywordflow">if</span>(poll (fds, 1, 10)) {</div><div class="line"><span class="comment">//              if ((fds [1].revents &amp; POLLIN) || ((data_readptr-1) &gt; data_endptr))</span></div><div class="line">                <span class="keywordflow">if</span> (fds [0].revents &amp; POLLIN)           <span class="comment">// incoming data on GPS data port</span></div><div class="line">                {</div><div class="line">                        err = ioctl(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, FIONREAD, &amp;i);</div><div class="line">                        <span class="keywordflow">if</span>(err)</div><div class="line">                        {</div><div class="line">                                fprintf(stderr,<span class="stringliteral">&quot;%s: I/O error, exiting.&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line">                                <a class="code" href="group__roc2__header.html#ga2896431d6a80cd39b3d24b40237612ee">quit</a>=1;</div><div class="line">                        }</div><div class="line"></div><div class="line"><span class="comment">//                      if(verbose) printf(&quot;%d bytes ready to read from %s\r\n&quot;,i, gps_data.port);</span></div><div class="line">                        <span class="keywordflow">if</span>((numread + i) &gt; <a class="code" href="group__roc2__header.html#gaa0534241791f23ec8098503582406166">READBUFSIZE</a>) <span class="comment">// Serial read will overrun buffer if we do it</span></div><div class="line">                        {</div><div class="line">                                err = <a class="code" href="group__roc2__code.html#gaf31e21e2ff935496c7ce8dc5e52b65c3">LogData</a>(<a class="code" href="group__roc2__header.html#gaa065f30aa9f5f9a42132c82c787ee70b">fp</a>, data_readbuf, numread);</div><div class="line">                                <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Logged %d bytes, err=%d : 2\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, numread, err);</div><div class="line">                                numread = 0;</div><div class="line">                        }</div><div class="line"></div><div class="line">                        numread += read(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, data_readbuf+numread, i);</div><div class="line"><span class="comment">//                      if(verbose) printf(&quot;Writing %d bytes\r\n&quot;, numread);</span></div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (fds [1].revents &amp; POLLIN)           <span class="comment">// incoming data on GPS command port</span></div><div class="line">                {</div><div class="line">                        ioctl(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, FIONREAD, &amp;i);</div><div class="line">                        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%d bytes ready to read from %s\r\n&quot;</span>,i, <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a name="a21"></a><a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>);</div><div class="line">                        <span class="keywordflow">if</span>((cmd_readptr + i - cmd_readbuf) &gt; <a class="code" href="group__roc2__header.html#gaa0534241791f23ec8098503582406166">READBUFSIZE</a>)       <span class="comment">// Serial read will overrun buffer if we do it</span></div><div class="line">                        {</div><div class="line">                                fprintf(stderr, <span class="stringliteral">&quot;Serial buffer overrun. Data lost!\r\n&quot;</span>);</div><div class="line">                                cmd_readptr=cmd_readbuf;</div><div class="line">                                memset(cmd_readbuf, 0, <span class="keyword">sizeof</span>(cmd_readbuf));</div><div class="line">                        }</div><div class="line">                        <span class="keywordflow">else</span></div><div class="line">                        {</div><div class="line">                                numread = read(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, cmd_readbuf, i);</div><div class="line"><span class="comment">//                              if(verbose) printf(&quot;Writing %d bytes\r\n&quot;, numread);</span></div><div class="line"><span class="comment">//                              if(verbose)</span></div><div class="line"><span class="comment">//                              {</span></div><div class="line"><span class="comment">//                                      for(j=0;j&lt;numread;j++)</span></div><div class="line"><span class="comment">//                                      {</span></div><div class="line"><span class="comment">//                                              printf(&quot;%02x &quot;, cmd_readbuf[j]);</span></div><div class="line"><span class="comment">//                                      }</span></div><div class="line"><span class="comment">//                                      printf(&quot;\r\n&quot;);</span></div><div class="line"><span class="comment">//                                      fflush(stdout);</span></div><div class="line"><span class="comment">//                              }</span></div><div class="line"><span class="comment">//                              err = LogData(fp, cmd_readbuf, numread);</span></div><div class="line"><span class="comment">//                              if(verbose) printf(&quot;LogData returned %d\r\n&quot;, err);</span></div><div class="line">                        }</div><div class="line">                } </div><div class="line">                }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Cleaning up\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line">        <a name="a22"></a><a class="code" href="group__roc2__code.html#ga5e6a6d4fac2c044a42fb2bff853d9718">RocCleanup</a>();</div><div class="line">        printf(<span class="stringliteral">&quot;%s: ROC stopped.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>) free(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>);</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>) free(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>);</div><div class="line">        <span class="keywordflow">if</span> (<a name="a23"></a><a class="code" href="group__roc2__header.html#ga12878be4d584d4841c7d409b8f024644">data_dir</a>) free(<a class="code" href="group__roc2__header.html#ga12878be4d584d4841c7d409b8f024644">data_dir</a>);</div><div class="line">        <span class="keywordflow">if</span> (<a name="a24"></a><a class="code" href="group__roc2__header.html#gab923c64de6e92e1b6a8efb77999e242e">curfilename</a>) free(<a class="code" href="group__roc2__header.html#gab923c64de6e92e1b6a8efb77999e242e">curfilename</a>);</div><div class="line"></div><div class="line">        exit(<a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/// \brief Performs module initialization</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="comment">/// Calls LoadConfigFileSettings() to load the configuration file settings for this module and calls</span></div><div class="line"><span class="comment">/// CmdLineHandler() to handle any command line options. Finally configures a ZMQ REP</span></div><div class="line"><span class="comment">/// socket to listen for messages from other modules.</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="comment">/// \param argc Number of command line arguments passed to main().</span></div><div class="line"><span class="comment">/// \param argv[] List of command line arguments passed to main().</span></div><div class="line"><span class="comment">/// \return</span></div><div class="line"><span class="comment">/// - BCSUCCESS if successful.</span></div><div class="line"><span class="comment">/// - BCCONFIGREADERROR indicates an error in LoadConfigFileSettings().</span></div><div class="line"><span class="comment">/// - BCCMDLINEERROR indicates an error in CmdLineHandler().</span></div><div class="line"><span class="comment">/// - BCZMQOPTERROR indicates an error setting the options of a ZMQ socket.</span></div><div class="line"><span class="comment">/// - BCMODLISTERROR indicates an error in PopulateModules().</span></div><div class="line"><span class="comment">/// - BCZMQBINDERROR indicates an error binding the ZMQ REP socket.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#gadaf639dd3b74bbc423f3e475d724f5bd">RocInit</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> err, port;</div><div class="line"></div><div class="line">        <a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = <a name="a25"></a><a class="code" href="group__roc2__header.html#gaa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line">        <a class="code" href="group__roc2__header.html#ga2896431d6a80cd39b3d24b40237612ee">quit</a> = <a class="code" href="group__roc2__header.html#gaa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"></div><div class="line">        fclose(stdin);</div><div class="line"></div><div class="line">        <span class="comment">// Read config file</span></div><div class="line">        <span class="keywordflow">if</span>(<a name="a26"></a><a class="code" href="group__roc2__code.html#ga8ed0e63e6cf78544f92b023037e3e7b8">LoadConfigFileSettings</a>(&amp;<a name="a27"></a><a class="code" href="group__roc2__header.html#ga6488e90355e8906ca5274fcfd451ffd3">cfgRoc</a>, <a name="a28"></a><a class="code" href="group__roc2__header.html#ga7aefac4844eee045f0c4b8279efc7bb8">pathCfgRoc</a>) != <a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>)</div><div class="line">                <span class="keywordflow">return</span>(<a name="a29"></a><a class="code" href="group__roc2__header.html#gacc734db768f05ebce6e4e985e44f46c5">BCCONFIGREADERROR</a>);              </div><div class="line"></div><div class="line">        <span class="comment">// Parse command line options</span></div><div class="line">        <span class="keywordflow">if</span>(<a name="a30"></a><a class="code" href="group__roc2__code.html#ga5dbf303fd2c465b1e724a247623fdbd2">CmdLineHandler</a>(argc, argv) != <a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>)</div><div class="line">        {</div><div class="line">                <a name="a31"></a><a class="code" href="group__roc2__code.html#ga40185ea52d16cecaafae70740e90af29">Usage</a>();</div><div class="line">                <span class="keywordflow">return</span>(<a name="a32"></a><a class="code" href="group__roc2__header.html#ga2e4e582aaaf87aeeb9f5cce7b1be9794">BCCMDLINEERROR</a>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// Set up serial ports</span></div><div class="line">        err = <a class="code" href="group__roc2__code.html#gaa1c32480aaf288a615cc7330e9cb6072">SerialPortInit</a>(&amp;<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>);</div><div class="line">        <span class="keywordflow">if</span>(err != <a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>)</div><div class="line">                <span class="keywordflow">return</span>(err);</div><div class="line">        err = <a class="code" href="group__roc2__code.html#gaa1c32480aaf288a615cc7330e9cb6072">SerialPortInit</a>(&amp;<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>);</div><div class="line">        <span class="keywordflow">if</span>(err != <a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>)</div><div class="line">                <span class="keywordflow">return</span>(err);</div><div class="line">        </div><div class="line">        <span class="comment">// Set up data logging</span></div><div class="line">        <a name="a33"></a><a class="code" href="group__roc2__code.html#ga0eaf55c523b081609cd85dd6eb04682b">CreateDayDirectory</a>();</div><div class="line">        <a name="a34"></a><a class="code" href="group__roc2__code.html#gaf8b73dc85a9b8da6978eac659ec8531b">OpenLogFile</a>(<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line">        clock_gettime(CLOCK_REALTIME, &amp;<a name="a35"></a><a class="code" href="group__roc2__header.html#ga133013525fac7907e0baa31ec30f8b4b">now</a>);    <span class="comment">// use internal clock for now. Eventually get times from data blocks</span></div><div class="line">        <a class="code" href="group__roc2__header.html#ga7efc4b1ce527042655fec03571c9042f">nextfile</a>.tv_sec = <a class="code" href="group__roc2__header.html#ga133013525fac7907e0baa31ec30f8b4b">now</a>.tv_sec + <a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a> - ((<a class="code" href="group__roc2__header.html#ga133013525fac7907e0baa31ec30f8b4b">now</a>.tv_sec + <a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a>) % <a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a>);</div><div class="line">        printf(<span class="stringliteral">&quot;now = %ld  len = %d  next = %ld\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga133013525fac7907e0baa31ec30f8b4b">now</a>.tv_sec, <a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a>, <a class="code" href="group__roc2__header.html#ga7efc4b1ce527042655fec03571c9042f">nextfile</a>.tv_sec);</div><div class="line">        <a class="code" href="group__roc2__header.html#ga7efc4b1ce527042655fec03571c9042f">nextfile</a>.tv_nsec = <a class="code" href="group__roc2__header.html#ga133013525fac7907e0baa31ec30f8b4b">now</a>.tv_nsec;</div><div class="line">        </div><div class="line">        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/// \brief Closes sockets and frees memory.</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="comment">/// There will be some serial port clean up stuff in here.</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="comment">/// \return Always returns BCSUCCESS</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#ga5e6a6d4fac2c044a42fb2bff853d9718">RocCleanup</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"></div><div class="line">        close(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>);</div><div class="line">        close(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>);</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/// \brief Parses command line arguments.</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="comment">/// \param argc Number of command line arguments passed to main().</span></div><div class="line"><span class="comment">/// \param argv[] List of command line arguments passed to main().</span></div><div class="line"><span class="comment">/// \return</span></div><div class="line"><span class="comment">/// - BCSUCCESS if successful</span></div><div class="line"><span class="comment">/// - BCERROR if there was an error parsing any of the command line options</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#ga5dbf303fd2c465b1e724a247623fdbd2">CmdLineHandler</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> i;</div><div class="line"></div><div class="line">        opterr=0;</div><div class="line">        optind=0;       <span class="comment">// Reinitialize getopt()</span></div><div class="line"></div><div class="line">        <span class="keywordflow">while</span> ((i = getopt (argc, argv, <a name="a36"></a><a class="code" href="group__roc2__header.html#gac8ac8737a0d1260142bafa03c1f8e566">cloptions</a>)) != -1)</div><div class="line">        <span class="keywordflow">switch</span> (i)</div><div class="line">                {</div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:               <span class="comment">// &#39;v&#39; option turns on verbose mode</span></div><div class="line">                                <a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = <a name="a37"></a><a class="code" href="group__roc2__header.html#gaa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line">                                <span class="keywordflow">break</span>;</div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:               <span class="comment">// &#39;l&#39; option specifies data file length</span></div><div class="line"><span class="comment">//                              file_len=get_baud(atoi(optarg));</span></div><div class="line">                                <a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a>=atoi(optarg);</div><div class="line">                                <span class="keywordflow">if</span>((<a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a> &lt; 0) || (<a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a> &gt; 3600))</div><div class="line">                                {</div><div class="line">                                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid file length setting %s\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, optarg);</div><div class="line">                                        <span class="keywordflow">return</span>(<a name="a38"></a><a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line">                                }</div><div class="line">                                printf(<span class="stringliteral">&quot;File length = %d\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a>);</div><div class="line">                                <span class="keywordflow">break</span>;</div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:               <span class="comment">// &#39;p&#39; option specifies serial port to use</span></div><div class="line">                                free(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>);</div><div class="line">                                <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a> = malloc(strlen(optarg)+1);</div><div class="line">                                strcpy(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>, optarg);</div><div class="line">                                <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a> == NULL)</div><div class="line">                                {</div><div class="line">                                        fprintf(stderr, <span class="stringliteral">&quot;%s: Error setting serial port to %s\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,optarg);</div><div class="line">                                        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line">                                }</div><div class="line">                                printf(<span class="stringliteral">&quot;Port = %s\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>);</div><div class="line">                                <span class="keywordflow">break</span>;</div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:               <span class="comment">// &#39;s&#39; option specifies serial port speed</span></div><div class="line">                                <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a>=<a name="a39"></a><a class="code" href="group__roc2__code.html#gaf890f66e1e86cf2e43aafd221eddabbd">get_baud</a>(atoi(optarg));</div><div class="line">                                <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a>=<a class="code" href="group__roc2__code.html#gaf890f66e1e86cf2e43aafd221eddabbd">get_baud</a>(atoi(optarg));</div><div class="line">                                <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a> == <a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>)</div><div class="line">                                {</div><div class="line">                                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid bits setting %s\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, optarg);</div><div class="line">                                        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line">                                }</div><div class="line">                                printf(<span class="stringliteral">&quot;Speed = %d\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a>);</div><div class="line">                                <span class="keywordflow">break</span>;</div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:               <span class="comment">// &#39;b&#39; option specifies serial port bit settings</span></div><div class="line">                                <span class="keywordflow">if</span>(<a name="a40"></a><a class="code" href="group__roc2__code.html#gadab6d320323ece6f7627cb9bb04d0eb9">verify_bits</a>(optarg))</div><div class="line">                                {</div><div class="line">                                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a name="a41"></a><a class="code" href="group__roc2__header.html#gad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = optarg[0]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line">                                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a name="a42"></a><a class="code" href="group__roc2__header.html#gad14da60f9217c7f12ee2224d23872b45">parity</a> = optarg[1];</div><div class="line">                                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a name="a43"></a><a class="code" href="group__roc2__header.html#ga6c0af9f2e97842405fb15ed952ef2976">stop</a> = optarg[2]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line">                                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#gad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = optarg[0]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line">                                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#gad14da60f9217c7f12ee2224d23872b45">parity</a> = optarg[1];</div><div class="line">                                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga6c0af9f2e97842405fb15ed952ef2976">stop</a> = optarg[2]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">else</span></div><div class="line">                                {</div><div class="line">                                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid bits setting %s\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, optarg);</div><div class="line">                                        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line">                                }</div><div class="line">                                printf(<span class="stringliteral">&quot;Bits = %d, Par = %c, Stop = %d\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#gad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>, <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#gad14da60f9217c7f12ee2224d23872b45">parity</a>,<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga6c0af9f2e97842405fb15ed952ef2976">stop</a>);</div><div class="line">                                <span class="keywordflow">break</span>;</div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:               <span class="comment">// &#39;f&#39; option specifies serial port flow control</span></div><div class="line">                                <span class="keywordflow">if</span>(<a name="a44"></a><a class="code" href="group__roc2__code.html#ga10d59c21de300f9eae88f1b90ef845f2">verify_flow</a>(optarg))</div><div class="line">                                {</div><div class="line">                                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a name="a45"></a><a class="code" href="group__roc2__header.html#ga0987f44fb6e6bc92483048e54ccd19da">flow</a> = optarg[0];</div><div class="line">                                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga0987f44fb6e6bc92483048e54ccd19da">flow</a> = optarg[0];</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">else</span></div><div class="line">                                {</div><div class="line">                                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid flow control setting %s\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, optarg);</div><div class="line">                                        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line">                                }</div><div class="line">                                printf(<span class="stringliteral">&quot;Flow = %c\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga0987f44fb6e6bc92483048e54ccd19da">flow</a>);</div><div class="line">                                <span class="keywordflow">break</span>;</div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;?&#39;</span>:</div><div class="line">                                <span class="keywordflow">if</span> ((optopt == <span class="charliteral">&#39;f&#39;</span>) || (optopt == <span class="charliteral">&#39;p&#39;</span>) || (optopt == <span class="charliteral">&#39;s&#39;</span>) || (optopt == <span class="charliteral">&#39;b&#39;</span>) || (optopt == <span class="charliteral">&#39;l&#39;</span>))</div><div class="line">                                        fprintf (stderr, <span class="stringliteral">&quot;%s: Option -%c requires an argument.\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,optopt);</div><div class="line">                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isprint (optopt))</div><div class="line">                                        fprintf (stderr, <span class="stringliteral">&quot;%s: Unknown option `-%c&#39;.\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,optopt);</div><div class="line">                                <span class="keywordflow">else</span></div><div class="line">                                        fprintf (stderr,<span class="stringliteral">&quot;%s: Unknown option character `\\x%x&#39;.\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,optopt);</div><div class="line">                                <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line">                        <span class="keywordflow">default</span>:</div><div class="line">                                <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line">                }</div><div class="line">        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/// \brief Prints the usage summary showing valid command line options.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__roc2__code.html#ga40185ea52d16cecaafae70740e90af29">Usage</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Usage:\r\n roc [OPTIONS]\r\n\r\n&quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;Options:\r\n -b &lt;bit settings&gt;\tUse &lt;bit settings&gt; for the serial port (default = %s).\r\n&quot;</span>,<a name="a46"></a><a class="code" href="group__roc2__header.html#ga22d8a5fa29f522516412a79347c65379">BITS_DEFAULT</a>);</div><div class="line">        printf(<span class="stringliteral">&quot; -f [N | H | S]\tSpecifies what type of flow control to use (N=None, H=Hardware, S=Software) (default=%c).\r\n&quot;</span>,<a name="a47"></a><a class="code" href="group__roc2__header.html#gad9fdf5915b4e8cea83af20712b77225c">FLOW_DEFAULT</a>);</div><div class="line">        printf(<span class="stringliteral">&quot; -s &lt;speed&gt;\tConfigure the serial ports for &lt;speed&gt; bits per second (default = %d).\r\n&quot;</span>,<a name="a48"></a><a class="code" href="group__roc2__header.html#ga13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a>);</div><div class="line">        printf(<span class="stringliteral">&quot; -l &lt;length&gt;\tCreate data files of length &lt;length&gt; seconds (default = %d).\r\n&quot;</span>,<a name="a49"></a><a class="code" href="group__roc2__header.html#gaf9f22696b250ded78ec1b89ab7629fed">FILE_LEN_DEFAULT</a>);</div><div class="line">        printf(<span class="stringliteral">&quot; -v\tVerbose mode.\r\n&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/// \brief Reads the program configuration file</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="comment">/// This function opens the module&#39;s configuration file (whose path is defined in the</span></div><div class="line"><span class="comment">/// pathCfgRoc global) and reads the contents. The currently supported settings that can</span></div><div class="line"><span class="comment">/// be placed in the config file are:</span></div><div class="line"><span class="comment">/// - (Optional) Port number to use for incoming socket connections (socket_in)</span></div><div class="line"><span class="comment">///</span></div><div class="line"><span class="comment">/// \param cfg Pointer to config_t object for storing state of config file operations.</span></div><div class="line"><span class="comment">/// \param path String containing full path of the config file to read.</span></div><div class="line"><span class="comment">/// \return</span></div><div class="line"><span class="comment">/// - BCSUCCESS if successful</span></div><div class="line"><span class="comment">/// - BCCONFIGREADERROR indicates an error reading the configuration file</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#ga8ed0e63e6cf78544f92b023037e3e7b8">LoadConfigFileSettings</a>(config_t *cfg, <span class="keyword">const</span> <span class="keywordtype">char</span> *path)</div><div class="line">{</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *str;</div><div class="line">        <span class="keywordtype">int</span> count, i;</div><div class="line"></div><div class="line">        config_init(cfg);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(config_read_file(cfg, path) == CONFIG_FALSE)</div><div class="line">        {</div><div class="line">                fprintf(stderr,<span class="stringliteral">&quot;%s: Error %s in config file %s, line %d\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, config_error_text(cfg),config_error_file(cfg),config_error_line(cfg));</div><div class="line">                config_destroy(cfg);</div><div class="line">                <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#gacc734db768f05ebce6e4e985e44f46c5">BCCONFIGREADERROR</a>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <a name="a50"></a><a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;data_dir&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line">        {</div><div class="line">                str = config_setting_get_string(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line">                <span class="keywordflow">if</span>(str != NULL)</div><div class="line">                {</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga12878be4d584d4841c7d409b8f024644">data_dir</a> = malloc(strlen(str)+1);</div><div class="line">                        strcpy(<a class="code" href="group__roc2__header.html#ga12878be4d584d4841c7d409b8f024644">data_dir</a>, str);</div><div class="line">                        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Data logged in %s.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="group__roc2__header.html#ga12878be4d584d4841c7d409b8f024644">data_dir</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid directory name %s in config file. Using default location %s\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, str, <a name="a51"></a><a class="code" href="group__roc2__header.html#ga5d4e9da7ecf27d35f3194989053adee0">DIR_DEFAULT</a>);</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga12878be4d584d4841c7d409b8f024644">data_dir</a> = <a class="code" href="group__roc2__header.html#ga5d4e9da7ecf27d35f3194989053adee0">DIR_DEFAULT</a>;</div><div class="line">                }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                <a class="code" href="group__roc2__header.html#ga12878be4d584d4841c7d409b8f024644">data_dir</a> = <a class="code" href="group__roc2__header.html#ga5d4e9da7ecf27d35f3194989053adee0">DIR_DEFAULT</a>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;gps_cmd_port&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line">        {</div><div class="line">                str = config_setting_get_string(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line">                <span class="keywordflow">if</span>(str != NULL)</div><div class="line">                {</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a> = malloc(strlen(str)+1);</div><div class="line">                        strcpy(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>, str);</div><div class="line">                        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: GPS commands on %s.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid device name %s in config file.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, str);</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a> = NULL;</div><div class="line">                }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a> = NULL;</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;gps_data_port&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line">        {</div><div class="line">                str = config_setting_get_string(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line">                <span class="keywordflow">if</span>(str != NULL)</div><div class="line">                {</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a> = malloc(strlen(str)+1);</div><div class="line">                        strcpy(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>, str);</div><div class="line">                        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: GPS data on %s.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid device name %s in config file.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, str);</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a> = NULL;</div><div class="line">                }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a> = NULL;</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;gps_cmd_speed&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line">        {</div><div class="line">                <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a> = <a class="code" href="group__roc2__code.html#gaf890f66e1e86cf2e43aafd221eddabbd">get_baud</a>(config_setting_get_int(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a>));</div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a> == <a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>)</div><div class="line">                {</div><div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid baud rate %d in config file %s. Using default vaule %d.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a>, path, <a class="code" href="group__roc2__header.html#ga13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a>);</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a> = <a class="code" href="group__roc2__header.html#ga13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Using baud rate %d for serial port %s from config file %s.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a>, <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>, path);</div><div class="line">                }</div><div class="line">        } </div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a> = <a class="code" href="group__roc2__header.html#ga13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;gps_data_speed&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line">        {</div><div class="line">                <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a> = <a class="code" href="group__roc2__code.html#gaf890f66e1e86cf2e43aafd221eddabbd">get_baud</a>(config_setting_get_int(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a>));</div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a> == <a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>)</div><div class="line">                {</div><div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid baud rate %d in config file %s. Using default vaule %d.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a>, path, <a class="code" href="group__roc2__header.html#ga13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a>);</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a> = <a class="code" href="group__roc2__header.html#ga13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Using baud rate %d for serial port %s from config file %s.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a>, <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>, path);</div><div class="line">                }</div><div class="line">        } </div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a> = <a class="code" href="group__roc2__header.html#ga13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;bits&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line">        {</div><div class="line">                str = config_setting_get_string(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="group__roc2__code.html#gadab6d320323ece6f7627cb9bb04d0eb9">verify_bits</a>(str))</div><div class="line">                {</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#gad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = str[0]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#gad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = str[0]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#gad14da60f9217c7f12ee2224d23872b45">parity</a> = str[1];</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#gad14da60f9217c7f12ee2224d23872b45">parity</a> = str[1];</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga6c0af9f2e97842405fb15ed952ef2976">stop</a> = str[2]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga6c0af9f2e97842405fb15ed952ef2976">stop</a> = str[2]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line">                        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Using serial bit settings %s.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, str);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid bits setting %s in config file. Using default value %s\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, str, <a class="code" href="group__roc2__header.html#ga22d8a5fa29f522516412a79347c65379">BITS_DEFAULT</a>);</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#gad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 8;</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#gad14da60f9217c7f12ee2224d23872b45">parity</a> = <span class="charliteral">&#39;N&#39;</span>;</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga6c0af9f2e97842405fb15ed952ef2976">stop</a> = 1;</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#gad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 8;</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#gad14da60f9217c7f12ee2224d23872b45">parity</a> = <span class="charliteral">&#39;N&#39;</span>;</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga6c0af9f2e97842405fb15ed952ef2976">stop</a> = 1;</div><div class="line">                }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#gad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 8;</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#gad14da60f9217c7f12ee2224d23872b45">parity</a> = <span class="charliteral">&#39;N&#39;</span>;</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga6c0af9f2e97842405fb15ed952ef2976">stop</a> = 1;</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#gad1e28a1a66a25529b0b61b9ca4e66d44">bits</a> = 8;</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#gad14da60f9217c7f12ee2224d23872b45">parity</a> = <span class="charliteral">&#39;N&#39;</span>;</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga6c0af9f2e97842405fb15ed952ef2976">stop</a> = 1;</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;flow&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line">        {</div><div class="line">                str = config_setting_get_string(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="group__roc2__code.html#ga10d59c21de300f9eae88f1b90ef845f2">verify_flow</a>(str))</div><div class="line">                {</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga0987f44fb6e6bc92483048e54ccd19da">flow</a> = str[0];</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga0987f44fb6e6bc92483048e54ccd19da">flow</a> = str[0];</div><div class="line">                        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Using %c flow control.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga0987f44fb6e6bc92483048e54ccd19da">flow</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid flow control setting %c in config file. Using default value %s\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, str[0], <a class="code" href="group__roc2__header.html#gad9fdf5915b4e8cea83af20712b77225c">FLOW_DEFAULT</a>);</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga0987f44fb6e6bc92483048e54ccd19da">flow</a> = <a class="code" href="group__roc2__header.html#gad9fdf5915b4e8cea83af20712b77225c">FLOW_DEFAULT</a>;</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga0987f44fb6e6bc92483048e54ccd19da">flow</a> = <a class="code" href="group__roc2__header.html#gad9fdf5915b4e8cea83af20712b77225c">FLOW_DEFAULT</a>;</div><div class="line">                }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga0987f44fb6e6bc92483048e54ccd19da">flow</a> = <a class="code" href="group__roc2__header.html#gad9fdf5915b4e8cea83af20712b77225c">FLOW_DEFAULT</a>;</div><div class="line">                        <a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga0987f44fb6e6bc92483048e54ccd19da">flow</a> = <a class="code" href="group__roc2__header.html#gad9fdf5915b4e8cea83af20712b77225c">FLOW_DEFAULT</a>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;terminator&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line">        {</div><div class="line">                str = config_setting_get_string(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line">                <span class="keywordflow">if</span>(str != NULL)</div><div class="line">                {</div><div class="line">                        strcpy(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga29c6cbcf2159ec289aa7742b1e99b316">term</a>, str);</div><div class="line">                        strcpy(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga29c6cbcf2159ec289aa7742b1e99b316">term</a>, str);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid line terminator specified. Using default value\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line">                        strcpy(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga29c6cbcf2159ec289aa7742b1e99b316">term</a>, <a name="a52"></a><a class="code" href="group__roc2__header.html#gae315cdbfa1dca5c4f0468fe98782056c">TERM_DEFAULT</a>);</div><div class="line">                        strcpy(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga29c6cbcf2159ec289aa7742b1e99b316">term</a>, <a class="code" href="group__roc2__header.html#gae315cdbfa1dca5c4f0468fe98782056c">TERM_DEFAULT</a>);</div><div class="line">                }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                strcpy(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga29c6cbcf2159ec289aa7742b1e99b316">term</a>, <a class="code" href="group__roc2__header.html#gae315cdbfa1dca5c4f0468fe98782056c">TERM_DEFAULT</a>);</div><div class="line">                strcpy(<a class="code" href="group__roc2__header.html#gae287744d86d503c3f6388d2761440021">gps_data</a>.<a class="code" href="group__roc2__header.html#ga29c6cbcf2159ec289aa7742b1e99b316">term</a>, <a class="code" href="group__roc2__header.html#gae315cdbfa1dca5c4f0468fe98782056c">TERM_DEFAULT</a>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;file_len&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line">        {</div><div class="line">                <a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a> = config_setting_get_int(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line">                <span class="keywordflow">if</span>((<a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a> &lt; 0) || (<a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a> &gt; 3600))</div><div class="line">                {</div><div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid file length %d. Using default value %d\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="group__roc2__header.html#gaf9f22696b250ded78ec1b89ab7629fed">FILE_LEN_DEFAULT</a>);</div><div class="line">                        <a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a> = <a class="code" href="group__roc2__header.html#gaf9f22696b250ded78ec1b89ab7629fed">FILE_LEN_DEFAULT</a>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Using file length %d.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a>);</div><div class="line">                }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                <a class="code" href="group__roc2__header.html#ga40c07165efeb9ce3aff7ce4c4d02af26">file_len</a> = <a class="code" href="group__roc2__header.html#gaf9f22696b250ded78ec1b89ab7629fed">FILE_LEN_DEFAULT</a>;</div><div class="line">        }</div><div class="line"></div><div class="line">        config_destroy(cfg);</div><div class="line">        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#gaa1c32480aaf288a615cc7330e9cb6072">SerialPortInit</a>(<a name="_a53"></a><a class="code" href="structserial.html">serial</a> *port)</div><div class="line">{</div><div class="line">        <span class="keyword">struct </span>termios options;</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Opening port %s\r\n&quot;</span>,port-&gt;<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>);</div><div class="line">        port-&gt;<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a> = open(port-&gt;<a class="code" href="group__roc2__header.html#ga74b83d1a2e086188b8e87ca651f3a610">port</a>, O_RDWR | O_NOCTTY | O_NDELAY);      <span class="comment">// Open serial port</span></div><div class="line">        <span class="keywordflow">if</span>(port-&gt;<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a> == <a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>)</div><div class="line">                <span class="keywordflow">return</span>(<a name="a54"></a><a class="code" href="group__roc2__header.html#ga917385f51ef11c435842e3a175902f42">BCSEROPENERROR</a>);</div><div class="line"></div><div class="line">        tcgetattr(port-&gt;<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, &amp;options);                                          <span class="comment">// Get current port options</span></div><div class="line"></div><div class="line">        cfsetispeed(&amp;options, port-&gt;<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a>);                             <span class="comment">// Set input baud rate</span></div><div class="line">        cfsetospeed(&amp;options, port-&gt;<a class="code" href="group__roc2__header.html#ga218b4f7c6cc2681a99c23a3b089d68b1">speed</a>);                             <span class="comment">// Set output baud rate</span></div><div class="line"></div><div class="line">        options.c_cflag &amp;= ~CSIZE;                                                      <span class="comment">// Clear data bit fields</span></div><div class="line">        <span class="keywordflow">switch</span>(port-&gt;<a class="code" href="group__roc2__header.html#gad1e28a1a66a25529b0b61b9ca4e66d44">bits</a>)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">case</span> 7:</div><div class="line">                        options.c_cflag |= CS7;                                         <span class="comment">// Select 7 data bits</span></div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> 8:</div><div class="line">                        options.c_cflag |= CS8;                                         <span class="comment">// Select 8 data bits</span></div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">default</span>:</div><div class="line">                        <span class="keywordflow">return</span>(<a name="a55"></a><a class="code" href="group__roc2__header.html#gae81be3717fce090da2f1fead60cbcaee">BCINVALIDBITS</a>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">switch</span>(port-&gt;<a class="code" href="group__roc2__header.html#gad14da60f9217c7f12ee2224d23872b45">parity</a>)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div><div class="line">                        options.c_cflag &amp;= ~PARENB;                                     <span class="comment">// Clear parity enable bit</span></div><div class="line">                        options.c_iflag &amp;= ~INPCK;                                      <span class="comment">// Disable parity checking of incoming data</span></div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;O&#39;</span>:</div><div class="line">                        options.c_cflag |= PARENB;                                      <span class="comment">// Set parity enable bit</span></div><div class="line">                        options.c_cflag |= PARODD;                                      <span class="comment">// Set odd parity bit</span></div><div class="line">                        options.c_iflag |= (INPCK | ISTRIP);            <span class="comment">// Enable parity checking of incoming data</span></div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;E&#39;</span>:</div><div class="line">                        options.c_cflag |= PARENB;                                      <span class="comment">// Set parity enable bit</span></div><div class="line">                        options.c_cflag &amp;= ~PARODD;                                     <span class="comment">// Clear odd parity bit (which means use even parity)</span></div><div class="line">                        options.c_iflag |= (INPCK | ISTRIP);            <span class="comment">// Enable parity checking of incoming data</span></div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">default</span>:</div><div class="line">                        <span class="keywordflow">return</span>(<a name="a56"></a><a class="code" href="group__roc2__header.html#ga95fc7e0c0cea8fdb89d2b22411469b5e">BCINVALIDPAR</a>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">switch</span>(port-&gt;<a class="code" href="group__roc2__header.html#ga6c0af9f2e97842405fb15ed952ef2976">stop</a>)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">case</span> 1:</div><div class="line">                        options.c_cflag &amp;= ~CSTOPB;                                     <span class="comment">// Clear stop bits bit (which means use 1 stop bit)</span></div><div class="line">                        <span class="keywordflow">break</span>;                  </div><div class="line">                <span class="keywordflow">case</span> 2:</div><div class="line">                        options.c_cflag |= CSTOPB;                                      <span class="comment">// Set stop bits bit (which means use 2 stop bits)</span></div><div class="line">                        <span class="keywordflow">break</span>;                  </div><div class="line">                <span class="keywordflow">default</span>:</div><div class="line">                        <span class="keywordflow">return</span>(<a name="a57"></a><a class="code" href="group__roc2__header.html#gac5ed0d3199ad199fb8af5fd13af5ed76">BCINVALIDSTOP</a>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">switch</span>(port-&gt;<a class="code" href="group__roc2__header.html#ga0987f44fb6e6bc92483048e54ccd19da">flow</a>)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div><div class="line">                        options.c_cflag &amp;= ~CRTSCTS;                            <span class="comment">// Disable hardware flow control</span></div><div class="line">                        options.c_iflag &amp;= ~(IXON | IXOFF | IXANY);     <span class="comment">// Disable software flow control</span></div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;H&#39;</span>:</div><div class="line">                        options.c_cflag |= CRTSCTS;                                     <span class="comment">// Enable hardware flow control</span></div><div class="line">                        options.c_iflag &amp;= ~(IXON | IXOFF | IXANY);     <span class="comment">// Disable software flow control</span></div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>:</div><div class="line">                        options.c_cflag &amp;= ~CRTSCTS;                            <span class="comment">// Disable hardware flow control</span></div><div class="line">                        options.c_iflag |= (IXON | IXOFF | IXANY);      <span class="comment">// Enable software flow control</span></div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">default</span>:</div><div class="line">                        <span class="keywordflow">return</span>(<a name="a58"></a><a class="code" href="group__roc2__header.html#ga3cc54957cc0646a3182940f88684be4d">BCINVALIDFLOW</a>);</div><div class="line">        }</div><div class="line"></div><div class="line">        options.c_iflag &amp;= ~ICRNL;                                                      <span class="comment">// disable mapping of CR to NL</span></div><div class="line">        options.c_lflag &amp;= ~(ICANON | ECHO | ECHOE | ECHOK | ECHONL | ECHOCTL | ECHOPRT | ECHOKE | ISIG);       <span class="comment">// Turn off line read (canonical) mode and character echoes</span></div><div class="line">        options.c_cflag |= CLOCAL;                                                      <span class="comment">// Set local mode</span></div><div class="line"><span class="comment">//      options.c_cflag &amp;= ~CREAD;                                                      // Disable the receiver for now</span></div><div class="line">        options.c_cflag |= CREAD;                                                       <span class="comment">// Enable the receiver</span></div><div class="line">        options.c_oflag &amp;= ~OPOST;                                                      <span class="comment">// Disable all processed output settings</span></div><div class="line">        options.c_cc[VMIN] = 0;                                                         <span class="comment">// Forces the read() function to return immediately with however many characters are available</span></div><div class="line">        options.c_cc[VTIME] = 0;                                                        <span class="comment">// Tells the read() function not to wait for any data</span></div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(tcsetattr(port-&gt;<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, TCSANOW, &amp;options) == 0) <span class="comment">// Make the new settings active</span></div><div class="line">        {</div><div class="line">                sleep(2);</div><div class="line">                tcflush(port-&gt;<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>,TCIOFLUSH);</div><div class="line">                <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">                <span class="keywordflow">return</span>(<a name="a59"></a><a class="code" href="group__roc2__header.html#ga883799ad282c86bfe883fe8861adaf21">BCSETATTRERROR</a>);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#gae79420e415eafcf286a5f045194271d1">GPSStartupCmds</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> count, i, ret, skipped;</div><div class="line">        <span class="keywordtype">char</span> *cmdstr=NULL, *confstr, *configfile;</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *str;</div><div class="line">        FILE *cmdfile;</div><div class="line">        ssize_t numread;</div><div class="line">        <span class="keywordtype">size_t</span> len=0;</div><div class="line">        <span class="keywordtype">char</span> reply[256];</div><div class="line">        </div><div class="line">        config_init(&amp;<a name="a60"></a><a class="code" href="group__roc2__header.html#ga7aa4bbc7d3acca779d0bc8d55542e77e">cfgGps</a>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(config_read_file(&amp;<a class="code" href="group__roc2__header.html#ga7aa4bbc7d3acca779d0bc8d55542e77e">cfgGps</a>, <a name="a61"></a><a class="code" href="group__roc2__header.html#ga2139244053072412f44be9b73e45e838">pathCfgGps</a>)==CONFIG_FALSE)</div><div class="line">        {</div><div class="line">                config_destroy(&amp;<a class="code" href="group__roc2__header.html#ga7aa4bbc7d3acca779d0bc8d55542e77e">cfgGps</a>);</div><div class="line">                <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#gacc734db768f05ebce6e4e985e44f46c5">BCCONFIGREADERROR</a>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(&amp;<a class="code" href="group__roc2__header.html#ga7aa4bbc7d3acca779d0bc8d55542e77e">cfgGps</a>, <span class="stringliteral">&quot;startup&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line">        {</div><div class="line">                str = config_setting_get_string(<a class="code" href="group__roc2__header.html#ga7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line">                <span class="keywordflow">if</span>(str != NULL)</div><div class="line">                {</div><div class="line">                        configfile = malloc(strlen(str)+1);</div><div class="line">                        strcpy(configfile, str);</div><div class="line">                        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Using GPS config file %s.\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, configfile);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid GPS config file %s\r\n&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, str);</div><div class="line">                        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span>(configfile)</div><div class="line">                {</div><div class="line">                        cmdfile=fopen(configfile, <span class="stringliteral">&quot;r&quot;</span>);</div><div class="line">                        <span class="keywordflow">if</span>(!cmdfile)</div><div class="line">                        {</div><div class="line">                                fprintf(stderr, <span class="stringliteral">&quot;%s: Error opening GPS config file %s\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, configfile);</div><div class="line">                                <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line">                        }</div><div class="line"></div><div class="line">                        free(configfile);</div><div class="line">                }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                <span class="keywordflow">return</span>(0);</div><div class="line">        }</div><div class="line"></div><div class="line"><span class="comment">// getline allocates memory when cmdstr = NULL, to allow unknown length strings</span></div><div class="line">        i = 0;</div><div class="line">        <span class="keywordflow">while</span>((numread = getline(&amp;cmdstr, &amp;len, cmdfile)) != -1)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">if</span>(ret = <a name="a62"></a><a class="code" href="group__roc2__code.html#ga7f92f656ab477dd3291c283949629ea7">SendGpsCmd</a>(cmdstr, 12000))</div><div class="line">                {</div><div class="line">                        fprintf(stderr, <span class="stringliteral">&quot;%s: Error %d sending command %s to GPS receiver.\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, ret, cmdstr);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                        <span class="keywordflow">if</span> (cmdstr) free(cmdstr);</div><div class="line">                        cmdstr = NULL;</div><div class="line">                        <span class="keywordflow">if</span>(<a name="a63"></a><a class="code" href="group__roc2__code.html#ga9e3db1d6a78924426ef881d1e3303220">GetGpsReply</a>(reply, 3000) == -1) fprintf(stderr, <span class="stringliteral">&quot;%s: Timeout error waiting for GPS reply\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line">                        i++;</div><div class="line">                }</div><div class="line">        }</div><div class="line">        fclose(cmdfile);</div><div class="line">        <span class="keywordflow">if</span> (cmdstr) free(cmdstr);</div><div class="line">        config_destroy(&amp;<a class="code" href="group__roc2__header.html#ga7aa4bbc7d3acca779d0bc8d55542e77e">cfgGps</a>);</div><div class="line">        <span class="keywordflow">return</span>(i);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#gaf890f66e1e86cf2e43aafd221eddabbd">get_baud</a>(<span class="keywordtype">int</span> baud)</div><div class="line">{</div><div class="line">        <span class="keywordflow">switch</span> (baud) {</div><div class="line">        <span class="keywordflow">case</span> 300:</div><div class="line">                <span class="keywordflow">return</span> B300;</div><div class="line">        <span class="keywordflow">case</span> 600:</div><div class="line">                <span class="keywordflow">return</span> B600;</div><div class="line">        <span class="keywordflow">case</span> 1200:</div><div class="line">                <span class="keywordflow">return</span> B1200;</div><div class="line">        <span class="keywordflow">case</span> 2400:</div><div class="line">                <span class="keywordflow">return</span> B2400;</div><div class="line">        <span class="keywordflow">case</span> 4800:</div><div class="line">                <span class="keywordflow">return</span> B4800;</div><div class="line">        <span class="keywordflow">case</span> 9600:</div><div class="line">                <span class="keywordflow">return</span> B9600;</div><div class="line">        <span class="keywordflow">case</span> 19200:</div><div class="line">                <span class="keywordflow">return</span> B19200;</div><div class="line">        <span class="keywordflow">case</span> 38400:</div><div class="line">                <span class="keywordflow">return</span> B38400;</div><div class="line">        <span class="keywordflow">case</span> 57600:</div><div class="line">                <span class="keywordflow">return</span> B57600;</div><div class="line">        <span class="keywordflow">case</span> 115200:</div><div class="line">                <span class="keywordflow">return</span> B115200;</div><div class="line">        <span class="keywordflow">case</span> 230400:</div><div class="line">                <span class="keywordflow">return</span> B230400;</div><div class="line">        <span class="keywordflow">case</span> 460800:</div><div class="line">                <span class="keywordflow">return</span> B460800;</div><div class="line">        <span class="keywordflow">case</span> 500000:</div><div class="line">                <span class="keywordflow">return</span> B500000;</div><div class="line">        <span class="keywordflow">case</span> 576000:</div><div class="line">                <span class="keywordflow">return</span> B576000;</div><div class="line">        <span class="keywordflow">case</span> 921600:</div><div class="line">                <span class="keywordflow">return</span> B921600;</div><div class="line">        <span class="keywordflow">case</span> 1000000:</div><div class="line">                <span class="keywordflow">return</span> B1000000;</div><div class="line">        <span class="keywordflow">case</span> 1152000:</div><div class="line">                <span class="keywordflow">return</span> B1152000;</div><div class="line">        <span class="keywordflow">case</span> 1500000:</div><div class="line">                <span class="keywordflow">return</span> B1500000;</div><div class="line">        <span class="keywordflow">case</span> 2000000:</div><div class="line">                <span class="keywordflow">return</span> B2000000;</div><div class="line">        <span class="keywordflow">case</span> 2500000:</div><div class="line">                <span class="keywordflow">return</span> B2500000;</div><div class="line">        <span class="keywordflow">case</span> 3000000:</div><div class="line">                <span class="keywordflow">return</span> B3000000;</div><div class="line">        <span class="keywordflow">case</span> 3500000:</div><div class="line">                <span class="keywordflow">return</span> B3500000;</div><div class="line">        <span class="keywordflow">case</span> 4000000:</div><div class="line">                <span class="keywordflow">return</span> B4000000;</div><div class="line">        <span class="keywordflow">default</span>: </div><div class="line">                <span class="keywordflow">return</span> <a class="code" href="group__roc2__header.html#ga92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>;</div><div class="line">        }</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#gadab6d320323ece6f7627cb9bb04d0eb9">verify_bits</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *bits)</div><div class="line">{</div><div class="line">        <span class="keywordflow">if</span>(((bits[0]==<span class="charliteral">&#39;7&#39;</span>) || (bits[0]==<span class="charliteral">&#39;8&#39;</span>)) &amp;&amp; ((toupper(bits[1])==<span class="charliteral">&#39;N&#39;</span>) || (toupper(bits[1])==<span class="charliteral">&#39;O&#39;</span>) || (toupper(bits[1])==<span class="charliteral">&#39;E&#39;</span>)) &amp;&amp; ((bits[2]==<span class="charliteral">&#39;1&#39;</span>) || (bits[2]==<span class="charliteral">&#39;2&#39;</span>)))</div><div class="line">                <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#gaa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">                <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#gaa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#ga10d59c21de300f9eae88f1b90ef845f2">verify_flow</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *bits)</div><div class="line">{</div><div class="line">        <span class="keywordflow">if</span>((toupper(bits[0])==<span class="charliteral">&#39;N&#39;</span>) || (toupper(bits[0])==<span class="charliteral">&#39;H&#39;</span>) || (toupper(bits[0])==<span class="charliteral">&#39;S&#39;</span>))</div><div class="line">                <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#gaa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">                <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#gaa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">char</span> *<a name="a64"></a><a class="code" href="group__roc2__code.html#ga0bacb9e2137b9572d5f02c23de2ad813">TodaysDirectoryName</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">        time_t epoch;</div><div class="line">        <span class="keyword">struct </span>tm *<a class="code" href="group__roc2__header.html#ga133013525fac7907e0baa31ec30f8b4b">now</a>;</div><div class="line">        <span class="keyword">struct </span>timespec ts;</div><div class="line">        <span class="keywordtype">char</span> *dirname;</div><div class="line"></div><div class="line">        dirname = &amp;<a name="a65"></a><a class="code" href="group__roc2__header.html#gacf09df540c710aea6e3e39d4c149f119">todaysDirectoryName</a>[0];</div><div class="line">        epoch = time(NULL);</div><div class="line"><span class="comment">//      epoch = ts.tv_sec;</span></div><div class="line">        now = gmtime(&amp;epoch);</div><div class="line">        sprintf(dirname,<span class="stringliteral">&quot;%04d%02d%02d&quot;</span>, (now-&gt;tm_year)+1900, (now-&gt;tm_mon)+1, now-&gt;tm_mday);</div><div class="line">        <span class="keywordflow">return</span>(dirname);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">char</span> *<a name="a66"></a><a class="code" href="group__roc2__code.html#ga29819f4927e98849304e948f13c12574">TodaysDirectoryPath</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> len;</div><div class="line">        <span class="keywordtype">char</span> *dirname, *fullpath;</div><div class="line"></div><div class="line">        dirname = <a class="code" href="group__roc2__code.html#ga0bacb9e2137b9572d5f02c23de2ad813">TodaysDirectoryName</a>();</div><div class="line"></div><div class="line">        len = strlen(<a class="code" href="group__roc2__header.html#ga12878be4d584d4841c7d409b8f024644">data_dir</a>);</div><div class="line">        fullpath = &amp;<a name="a67"></a><a class="code" href="group__roc2__header.html#ga17c8b16a620d8fa68aa30017abe96c50">todaysDirectoryPath</a>[0];     <span class="comment">// +3 is for 2 &#39;/&#39;s that we&#39;re adding plus the null terminator</span></div><div class="line">        <span class="keywordflow">if</span>(fullpath == NULL) <span class="keywordflow">return</span> (NULL);</div><div class="line">        strcpy(fullpath, <a class="code" href="group__roc2__header.html#ga12878be4d584d4841c7d409b8f024644">data_dir</a>);</div><div class="line">        strcpy(fullpath + len, <span class="stringliteral">&quot;/&quot;</span>);</div><div class="line">        strcpy(fullpath + len + 1, dirname);</div><div class="line">        strcpy(fullpath + len + 1 + strlen(dirname), <span class="stringliteral">&quot;/&quot;</span>);</div><div class="line">        fullpath[len + strlen(dirname) + 2] = 0;        <span class="comment">// Null term</span></div><div class="line">        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga17c8b16a620d8fa68aa30017abe96c50">todaysDirectoryPath</a>);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a68"></a><a class="code" href="group__roc2__code.html#ga88fb6383c5c934e876be013729f8ab60">TodaysDirectoryExists</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> i, found;</div><div class="line">        DIR *dir;</div><div class="line"></div><div class="line">        found = <a class="code" href="group__roc2__header.html#gaa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"></div><div class="line">        dir = opendir(<a class="code" href="group__roc2__code.html#ga29819f4927e98849304e948f13c12574">TodaysDirectoryPath</a>());</div><div class="line">        <span class="keywordflow">if</span>(!dir)</div><div class="line">                <span class="keywordflow">if</span>(ENOENT == errno)             <span class="comment">// Directory not found</span></div><div class="line">                {</div><div class="line">                        found = <a class="code" href="group__roc2__header.html#gaa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span>                                    <span class="comment">// Some other error occurred</span></div><div class="line">                {</div><div class="line">                        <span class="keywordflow">return</span>(<a name="a69"></a><a class="code" href="group__roc2__header.html#ga3cd32c0121e7225577c4bc3c456c9771">BCFILEOPENERROR</a>);</div><div class="line">                }</div><div class="line">                        </div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">if</span>(found) printf(<span class="stringliteral">&quot;%s: Found %s\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="group__roc2__code.html#ga0bacb9e2137b9572d5f02c23de2ad813">TodaysDirectoryName</a>());</div><div class="line">                <span class="keywordflow">else</span> printf(<span class="stringliteral">&quot;%s: Did not find %s\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="group__roc2__code.html#ga0bacb9e2137b9572d5f02c23de2ad813">TodaysDirectoryName</a>());</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span>(found);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#ga0eaf55c523b081609cd85dd6eb04682b">CreateDayDirectory</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> i, ret;</div><div class="line"></div><div class="line">        ret = mkdir(<a class="code" href="group__roc2__code.html#ga29819f4927e98849304e948f13c12574">TodaysDirectoryPath</a>(), 0777);</div><div class="line">        <span class="keywordflow">if</span>(ret)</div><div class="line">                <span class="keywordflow">if</span>(errno != EEXIST)             <span class="comment">// Existing directories not an error, anything else is</span></div><div class="line">                {</div><div class="line">                        <span class="keywordflow">return</span>(errno);</div><div class="line">                }</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">char</span> *<a name="a70"></a><a class="code" href="group__roc2__code.html#ga45786db9b46a6cc20e64bd0a851655bc">LogFileName</a>(<span class="keywordtype">char</span> *name)</div><div class="line">{</div><div class="line">        time_t epoch;</div><div class="line">        <span class="keyword">struct </span>tm *<a class="code" href="group__roc2__header.html#ga133013525fac7907e0baa31ec30f8b4b">now</a>;</div><div class="line">        <span class="keywordtype">char</span> *rootname, *fullpath;</div><div class="line">        <span class="keyword">struct </span>timespec ts;</div><div class="line">        <span class="keywordtype">char</span> filename[50];      <span class="comment">// format is YYYYMMDDhhmmss_name.txt</span></div><div class="line"></div><div class="line">        epoch = time(NULL);</div><div class="line"><span class="comment">//      epoch = ts.tv_sec;</span></div><div class="line">        now = gmtime(&amp;epoch);</div><div class="line">        sprintf(filename,<span class="stringliteral">&quot;%s_%04d%02d%02d%02d%02d%02d.sbf&quot;</span>, name, (now-&gt;tm_year)+1900, (now-&gt;tm_mon)+1, now-&gt;tm_mday, now-&gt;tm_hour, now-&gt;tm_min, now-&gt;tm_sec);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>((rootname = <a class="code" href="group__roc2__code.html#ga29819f4927e98849304e948f13c12574">TodaysDirectoryPath</a>()) == NULL)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">return</span>(NULL);</div><div class="line">        }</div><div class="line"></div><div class="line">        fullpath = &amp;<a name="a71"></a><a class="code" href="group__roc2__header.html#ga6195294dffffff6b11f3b629568b055e">logFileName</a>[0];             <span class="comment">// +1&#39;s are for the &#39;/&#39; and null term</span></div><div class="line">        strcpy(fullpath, rootname);</div><div class="line"><span class="comment">//      strcpy(fullpath + strlen(rootname), &quot;/&quot;);</span></div><div class="line">        strcpy(fullpath + strlen(rootname), filename);</div><div class="line">        fullpath[strlen(rootname) + strlen(filename)] = 0;</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga6195294dffffff6b11f3b629568b055e">logFileName</a>);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#gaf8b73dc85a9b8da6978eac659ec8531b">OpenLogFile</a>(<span class="keywordtype">char</span> *name)</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> i, index, ret;</div><div class="line">        <span class="keywordtype">char</span> *strName;</div><div class="line">        <span class="keywordtype">char</span> reply[256];</div><div class="line"></div><div class="line">        <a class="code" href="group__roc2__code.html#ga7f92f656ab477dd3291c283949629ea7">SendGpsCmd</a>(<span class="stringliteral">&quot;enoc, COM2, RMC\r&quot;</span>, 1000);</div><div class="line">        <a class="code" href="group__roc2__code.html#ga9e3db1d6a78924426ef881d1e3303220">GetGpsReply</a>(reply, 3000);</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span>(!<a class="code" href="group__roc2__code.html#ga88fb6383c5c934e876be013729f8ab60">TodaysDirectoryExists</a>())</div><div class="line">        {</div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="group__roc2__code.html#ga0eaf55c523b081609cd85dd6eb04682b">CreateDayDirectory</a>()) <span class="keywordflow">return</span>(<a name="a72"></a><a class="code" href="group__roc2__header.html#gabc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line">        }</div><div class="line"></div><div class="line">        ret = <a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>((strName = <a class="code" href="group__roc2__code.html#ga45786db9b46a6cc20e64bd0a851655bc">LogFileName</a>(name)) == NULL)</div><div class="line">        {</div><div class="line">                fprintf(stderr, <span class="stringliteral">&quot;%s: Error generating log file name.\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line">                <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#gabc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>((<a class="code" href="group__roc2__header.html#gaa065f30aa9f5f9a42132c82c787ee70b">fp</a> = fopen(strName, <span class="stringliteral">&quot;a+&quot;</span>)) == NULL)</div><div class="line">        {</div><div class="line">                fprintf(stderr, <span class="stringliteral">&quot;%s: Error Opening log file %s.\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, strName);</div><div class="line">                ret = <a class="code" href="group__roc2__header.html#ga3cd32c0121e7225577c4bc3c456c9771">BCFILEOPENERROR</a>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) </div><div class="line">                {</div><div class="line">                        printf(<span class="stringliteral">&quot;%s: Opened log file %s.\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, strName);</div><div class="line">                        fflush(stdout);</div><div class="line">                }</div><div class="line">                <a class="code" href="group__roc2__header.html#gab923c64de6e92e1b6a8efb77999e242e">curfilename</a> = malloc(strlen(strName));</div><div class="line">                strcpy(<a class="code" href="group__roc2__header.html#gab923c64de6e92e1b6a8efb77999e242e">curfilename</a>, strName);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span>(ret);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a73"></a><a class="code" href="group__roc2__code.html#ga84b0f0a6d9c4b56b743eb5b171f3172c">CloseLogFile</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> i, index, err, ret;</div><div class="line"></div><div class="line">        ret = <a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(err = fclose(<a class="code" href="group__roc2__header.html#gaa065f30aa9f5f9a42132c82c787ee70b">fp</a>))</div><div class="line">        {</div><div class="line">                fprintf(stderr, <span class="stringliteral">&quot;%s: Error closing log file.\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line">                ret = <a class="code" href="group__roc2__header.html#gabc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(ret == <a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Closed log file.\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span>(ret);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#ga5366f78d45883b7ad5934d6910efa6c5">NewFile</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"><span class="comment">//      led(ORANGE);</span></div><div class="line">        <a class="code" href="group__roc2__code.html#ga84b0f0a6d9c4b56b743eb5b171f3172c">CloseLogFile</a>();</div><div class="line">        <a name="a74"></a><a class="code" href="group__roc2__code.html#gad5286e2927749d97bf22eaf1173fccdd">CopyFile</a>(<a class="code" href="group__roc2__header.html#gab923c64de6e92e1b6a8efb77999e242e">curfilename</a>);</div><div class="line">        <a class="code" href="group__roc2__code.html#gaf8b73dc85a9b8da6978eac659ec8531b">OpenLogFile</a>(<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><span class="comment">//      led(OFF);</span></div><div class="line"></div><div class="line">        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#gaf31e21e2ff935496c7ce8dc5e52b65c3">LogData</a>(FILE *<a class="code" href="group__roc2__header.html#gaa065f30aa9f5f9a42132c82c787ee70b">fp</a>, <span class="keywordtype">char</span> *data, <span class="keywordtype">int</span> n)</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> ret;</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#gaa065f30aa9f5f9a42132c82c787ee70b">fp</a>==NULL)</div><div class="line">        {</div><div class="line">                fprintf(stderr,<span class="stringliteral">&quot;%s: Error. Invalid log file stream\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line">                <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#gabc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line">        }</div><div class="line">        ret = fwrite(data, 1, n, <a class="code" href="group__roc2__header.html#gaa065f30aa9f5f9a42132c82c787ee70b">fp</a>);</div><div class="line">        fflush(<a class="code" href="group__roc2__header.html#gaa065f30aa9f5f9a42132c82c787ee70b">fp</a>);</div><div class="line">        <span class="keywordflow">return</span>(ret);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#gad5286e2927749d97bf22eaf1173fccdd">CopyFile</a>(<span class="keywordtype">char</span> *name)</div><div class="line">{</div><div class="line">        <span class="keywordtype">char</span> cmd[128];</div><div class="line">        <span class="keywordtype">int</span> err;</div><div class="line">        </div><div class="line">        sprintf(cmd,<span class="stringliteral">&quot;cp %s %s&quot;</span>, name, <a name="a75"></a><a class="code" href="group__roc2__header.html#gaf3e7ebf92f13594acf3ba281bcfd1c0b">queueDir</a>);</div><div class="line"><span class="comment">//      sprintf(cmd,&quot;cp data.txt %s&quot;, queueDir);</span></div><div class="line">        <span class="keywordflow">if</span>((err==system(cmd)) &lt; 0)</div><div class="line">        {</div><div class="line">                fprintf(stderr, <span class="stringliteral">&quot;%s: Error copying data %s file to queue directory %s\r\n&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, name, <a class="code" href="group__roc2__header.html#gaf3e7ebf92f13594acf3ba281bcfd1c0b">queueDir</a>);</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">                fprintf(stderr, <span class="stringliteral">&quot;%s: data.txt copied\n&quot;</span>, cmd);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span>(err);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#ga7f92f656ab477dd3291c283949629ea7">SendGpsCmd</a>(<span class="keywordtype">char</span> *cmdstr, <span class="keywordtype">int</span> timeout)</div><div class="line">{</div><div class="line">        <span class="keywordtype">size_t</span> n;</div><div class="line">        <span class="keyword">struct </span>timespec spec;</div><div class="line">        <span class="keywordtype">int</span> prompt, i, numread, ptr;</div><div class="line">        <span class="keywordtype">char</span> inbuf[256];        <span class="comment">// needs to be big enough to hold replies from commands</span></div><div class="line">        <span class="keywordtype">double</span> nowtime, endtime;</div><div class="line">        </div><div class="line"><span class="comment">/* Get prompt to make sure GPS is ready to receive command.</span></div><div class="line"><span class="comment">        Return an error if prompt not received </span></div><div class="line"><span class="comment">*/</span></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Sending GPS command %s&quot;</span>, <a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, cmdstr);</div><div class="line">        clock_gettime(CLOCK_MONOTONIC, &amp;spec);</div><div class="line">        nowtime = spec.tv_sec + (spec.tv_nsec / 1000000000);</div><div class="line">        endtime = nowtime + (timeout/1000);</div><div class="line">        </div><div class="line">        write(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, <span class="stringliteral">&quot;\n&quot;</span>, 1);             <span class="comment">// send LF to get command prompt</span></div><div class="line">        prompt=0;</div><div class="line">        numread=0;</div><div class="line">        inbuf[0]=0;</div><div class="line">        ptr=0;</div><div class="line">        </div><div class="line">        <span class="keywordflow">while</span>(!prompt &amp;&amp; (nowtime &lt; endtime))           <span class="comment">// Wait until prompt (COMx&gt;) is received</span></div><div class="line">        {</div><div class="line">                ioctl(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, FIONREAD, &amp;i);</div><div class="line">                <span class="keywordflow">if</span>(i&gt;0)</div><div class="line">                {</div><div class="line">                        numread = read(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, inbuf+ptr, i);</div><div class="line">                        ptr += numread;</div><div class="line">                        inbuf[ptr] = 0;</div><div class="line">                        <span class="keywordflow">if</span>(strstr(inbuf, <span class="stringliteral">&quot;COM&quot;</span>) &amp;&amp; strstr(inbuf, <span class="stringliteral">&quot;&gt;&quot;</span>))</div><div class="line">                        {</div><div class="line">                                prompt = 1;</div><div class="line">                        }</div><div class="line">                }</div><div class="line">                clock_gettime(CLOCK_MONOTONIC, &amp;spec);</div><div class="line">                nowtime = spec.tv_sec + (spec.tv_nsec / 1000000000);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span>(nowtime &gt;= endtime)  <span class="keywordflow">return</span>(-1);             <span class="comment">// Timed out without receiving prompt</span></div><div class="line"></div><div class="line"><span class="comment">/* Send command</span></div><div class="line"><span class="comment">*/</span>      </div><div class="line">        n = write(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, cmdstr, strlen(cmdstr));          <span class="comment">// Send command</span></div><div class="line">        <span class="keywordflow">if</span>(n != strlen(cmdstr)) <span class="keywordflow">return</span>(-2);                                     <span class="comment">// Some sort of write error occurred</span></div><div class="line">        </div><div class="line">        <span class="keywordflow">return</span>(<a class="code" href="group__roc2__header.html#ga416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="group__roc2__code.html#ga9e3db1d6a78924426ef881d1e3303220">GetGpsReply</a>(<span class="keywordtype">char</span> *replybuf, <span class="keywordtype">int</span> timeout)</div><div class="line">{</div><div class="line">        <span class="keywordtype">size_t</span> n;</div><div class="line">        <span class="keywordtype">int</span> endreply, i, numread, ptr;</div><div class="line">        <span class="keyword">struct </span>timespec spec;</div><div class="line">        <span class="keywordtype">double</span> nowtime, endtime;</div><div class="line"></div><div class="line">        replybuf[0]=0;</div><div class="line">        </div><div class="line">        clock_gettime(CLOCK_MONOTONIC, &amp;spec);</div><div class="line">        nowtime = spec.tv_sec + (spec.tv_nsec / 1000000000);</div><div class="line">        endtime = nowtime + (timeout/1000);</div><div class="line">        </div><div class="line">        endreply = 0;</div><div class="line">        ptr = 0;</div><div class="line">        <span class="keywordflow">while</span>(!endreply &amp;&amp; (nowtime &lt; endtime))</div><div class="line">        {</div><div class="line">                ioctl(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, FIONREAD, &amp;i);</div><div class="line">                <span class="keywordflow">if</span>(i&gt;0)</div><div class="line">                {</div><div class="line">                        numread = read(<a class="code" href="group__roc2__header.html#ga92807ba34a45f6a37e21653d665b7e18">gps_cmd</a>.<a class="code" href="group__roc2__header.html#ga5c82fa58c263d40b70b737c5efa07ef0">fp</a>, replybuf+ptr, 1);</div><div class="line">                        ptr += numread;</div><div class="line">                        replybuf[ptr] = 0;</div><div class="line">                        <span class="keywordflow">if</span>(strstr(replybuf, <span class="stringliteral">&quot;COM&quot;</span>) &amp;&amp; strstr(replybuf, <span class="stringliteral">&quot;&gt;&quot;</span>))</div><div class="line">                        {</div><div class="line">                                endreply = 1;</div><div class="line">                        }</div><div class="line">                }</div><div class="line">                clock_gettime(CLOCK_MONOTONIC, &amp;spec);</div><div class="line">                nowtime = spec.tv_sec + (spec.tv_nsec / 1000000000);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span>(nowtime &gt;= endtime)  <span class="keywordflow">return</span>(-1);             <span class="comment">// Timed out without receiving prompt</span></div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__roc2__header.html#ga0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: GPS Reply = %s&quot;</span>,<a class="code" href="group__roc2__header.html#ga14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, replybuf);</div><div class="line">        <span class="keywordflow">return</span>(strlen(replybuf));</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**********************************</span></div><div class="line"><span class="comment">*</span></div><div class="line"><span class="comment">* gps_power(), gps_reset(), gps_power_toggle(), set_safe(), led(), set_gpio0()</span></div><div class="line"><span class="comment">*</span></div><div class="line"><span class="comment">* Description: These functions control the digital outputs of the TS-7680.</span></div><div class="line"><span class="comment">*</span></div><div class="line"><span class="comment">* Parameter: int state</span></div><div class="line"><span class="comment">*</span></div><div class="line"><span class="comment">* Return value: None</span></div><div class="line"><span class="comment">*</span></div><div class="line"><span class="comment">* These functions hide the active hi/lo nature of the signals so they can be</span></div><div class="line"><span class="comment">*   called as gps_power(ON), etc. without worrying about whether that&#39;s a</span></div><div class="line"><span class="comment">*   logic hi or lo. The argument to led() should be one of: GREEN, RED, ORANGE,</span></div><div class="line"><span class="comment">*   or OFF.</span></div><div class="line"><span class="comment">*</span></div><div class="line"><span class="comment">************************************/</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a name="a76"></a><a class="code" href="group__roc2__code.html#ga093f472d65a4478a2a23fa69ea593ef0">gps_power</a>(<span class="keywordtype">int</span> state)</div><div class="line">{</div><div class="line">        <span class="keywordtype">char</span> cmdstr[32];</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span>(state)</div><div class="line">        {</div><div class="line">                sprintf(cmdstr,<span class="stringliteral">&quot;gpio gps_power 0&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                sprintf(cmdstr,<span class="stringliteral">&quot;gpio gps_power 1&quot;</span>);</div><div class="line">        }</div><div class="line"></div><div class="line">        system(cmdstr);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a name="a77"></a><a class="code" href="group__roc2__code.html#gaf1aef5309c25647017f7108bc58873f7">gps_reset</a>(<span class="keywordtype">int</span> state)</div><div class="line">{</div><div class="line">        <span class="keywordtype">char</span> cmdstr[32];</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span>(state)</div><div class="line">        {</div><div class="line">                sprintf(cmdstr,<span class="stringliteral">&quot;gpio gps_reset 0&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                sprintf(cmdstr,<span class="stringliteral">&quot;gpio gps_reset 1&quot;</span>);</div><div class="line">        }</div><div class="line"></div><div class="line">        system(cmdstr);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a name="a78"></a><a class="code" href="group__roc2__code.html#ga450d4faa9f19206a09ccd2e461eff601">gps_power_toggle</a>(<span class="keywordtype">int</span> state)</div><div class="line">{</div><div class="line">        <span class="keywordtype">char</span> cmdstr[32];</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span>(state)</div><div class="line">        {</div><div class="line">                sprintf(cmdstr,<span class="stringliteral">&quot;gpio gps_pow_tog 0&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                sprintf(cmdstr,<span class="stringliteral">&quot;gpio gps_pow_tog 1&quot;</span>);</div><div class="line">        }</div><div class="line"></div><div class="line">        system(cmdstr);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a name="a79"></a><a class="code" href="group__roc2__code.html#ga7e696bce041fca9cc1924bcd65cbc503">set_safe</a>(<span class="keywordtype">int</span> state)</div><div class="line">{</div><div class="line">        <span class="keywordtype">char</span> cmdstr[32];</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span>(state)</div><div class="line">        {</div><div class="line">                sprintf(cmdstr,<span class="stringliteral">&quot;gpio safe 1&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                sprintf(cmdstr,<span class="stringliteral">&quot;gpio safe 0&quot;</span>);</div><div class="line">        }</div><div class="line"></div><div class="line">        system(cmdstr);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a name="a80"></a><a class="code" href="group__roc2__code.html#ga94bb341ea8ea68eb26f43e8664513609">led</a>(<span class="keywordtype">int</span> state)</div><div class="line">{</div><div class="line">        <span class="keywordtype">char</span> cmdstr[32];</div><div class="line">        </div><div class="line">        <span class="keywordflow">switch</span>(state)</div><div class="line">        {</div><div class="line">                <span class="keywordflow">case</span> <a name="a81"></a><a class="code" href="group__roc2__header.html#ga8d23feea868a983c8c2b661e1e16972f">RED</a>:</div><div class="line">                        sprintf(cmdstr,<span class="stringliteral">&quot;gpio led1 0&quot;</span>);</div><div class="line">                        system(cmdstr);</div><div class="line">                        sprintf(cmdstr,<span class="stringliteral">&quot;gpio led0 1&quot;</span>);</div><div class="line">                        system(cmdstr);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <a name="a82"></a><a class="code" href="group__roc2__header.html#gacfbc006ea433ad708fdee3e82996e721">GREEN</a>:</div><div class="line">                        sprintf(cmdstr,<span class="stringliteral">&quot;gpio led0 0&quot;</span>);</div><div class="line">                        system(cmdstr);</div><div class="line">                        sprintf(cmdstr,<span class="stringliteral">&quot;gpio led1 1&quot;</span>);</div><div class="line">                        system(cmdstr);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <a name="a83"></a><a class="code" href="group__roc2__header.html#gac5b6e19bf06822021f35602c59658de3">ORANGE</a>:</div><div class="line">                        sprintf(cmdstr,<span class="stringliteral">&quot;gpio led0 1&quot;</span>);</div><div class="line">                        system(cmdstr);</div><div class="line">                        sprintf(cmdstr,<span class="stringliteral">&quot;gpio led1 1&quot;</span>);</div><div class="line">                        system(cmdstr);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <a name="a84"></a><a class="code" href="group__roc2__header.html#ga29e413f6725b2ba32d165ffaa35b01e5">OFF</a>:</div><div class="line">                        sprintf(cmdstr,<span class="stringliteral">&quot;gpio led0 0&quot;</span>);</div><div class="line">                        system(cmdstr);</div><div class="line">                        sprintf(cmdstr,<span class="stringliteral">&quot;gpio led1 0&quot;</span>);</div><div class="line">                        system(cmdstr);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">        }               </div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a name="a85"></a><a class="code" href="group__roc2__code.html#gac266e79779ea42b506b577821d4a834d">set_gpio0</a>(<span class="keywordtype">int</span> state)</div><div class="line">{</div><div class="line">        <span class="keywordtype">char</span> cmdstr[32];</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span>(state)</div><div class="line">        {</div><div class="line">                sprintf(cmdstr,<span class="stringliteral">&quot;gpio gpio0 1&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">                sprintf(cmdstr,<span class="stringliteral">&quot;gpio gpio0 0&quot;</span>);</div><div class="line">        }</div><div class="line"></div><div class="line">        system(cmdstr);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a name="a86"></a><a class="code" href="group__roc2__code.html#ga27c5d4df2dd392e1ef8d20cd90998c26">led_blink</a>(<span class="keywordtype">int</span> color, <span class="keywordtype">int</span> num, <span class="keywordtype">int</span> duration)</div><div class="line">{</div><div class="line">        </div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
